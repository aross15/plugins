<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MultiVariateExtras</title>
    <!--
    ==========================================================================

     * Created by tim on 9/29/20. Modified by aross15 on 2025-07-02.


     ==========================================================================
    index in multiVariateExtras

        Author:   Tim Erickson; modified by aross15

    Copyright (c) unclear

        Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
        You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
    limitations under the License.
    ==========================================================================

    -->

    <!--
      LOCAL, TESTING:         http://localhost/plugins/multiVariateExtras/
      LOCAL testing WITH CODAP:
            http://localhost/codap/static/dg/en/cert/index.html?di=http://localhost/plugins/multiVariateExtras/
    -->


    <!--        jquery section      -->
    <script src="../common/jquery/jquery.min.js"></script>
    <link rel="stylesheet" type='text/css' href="../common/jquery/custom/jquery-ui.min.css">
    <script src="../common/jquery/custom/jquery-ui.min.js"></script>


    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Rokkitt:300,700' rel='stylesheet'>

    <link rel='stylesheet' type='text/css' href='css/multiVariateExtras.css'/>

    <script src="../common/src/iframe-phone.js"></script>
    <script src="../common/src/codapInterface.js"></script>
    <script src="../common/src/pluginHelper.js"></script>
    <script type="module" src="../common/src/TEEUtils.js"></script>

    <script src="src/MVE_stat_utils.js"></script>
    <script src="src/multiVariateExtras.js"></script>
    <script src="src/multiVariateExtras_ui.js"></script>
    <script src="src/connect.js?v=1"></script>
    <script src="src/notify.js"></script>

    <script src="../common/sweetalert2/dist/sweetalert2.all.min.js"></script>

    <script>
        $(function () {
            $("#tabs").tabs();
            if (typeof multiVariateExtras !== 'undefined') {
                multiVariateExtras.initialize();
            } else {
                console.error("multiVariateExtras is not defined. Check script loading order.");
            }
        });

    </script>

</head>

<body>

<div id="tabs">
    <ul>
        <li><a href="#dataset">dataset</a></li>
        <li><a href="#plot-matrix">plot matrix</a></li>
        <li><a href="#blocks-of-plots">Blocks of Plots</a></li>
        <li><a href="#correlation">correlation</a></li>
    </ul>
<!-- The idea of grouping attributes is similar to part of the Choosy plugin, but we use a different interface style here, and don't depend on the user running Choosy as well. -->


    <div id="dataset">
        <div id="multiVariateExtrasHeaderDIV" class="stripe">
            <h1 class="stripe-hed">MultiVariateExtras</h1>&emsp;
            <img class="stripe-element"
                 src="../common/art/refresh-empty.png"
                 onclick="multiVariateExtras.setUpDatasets()"
                 style="cursor: pointer"
                 height="16"
                 title="refresh" alt="refresh button"
            >
            <a class="stripe-element"
               target="_blank" href="https://github.com/aross15/plugins/blob/main/MultiVariateExtras/readme.md">
               
                <img src="../common/art/info.png" class="infoIcon" alt="info"
                     title="Drag the URL into an existing CODAP document. Do extra multivariate stuff.">
            </a>

        </div>

        <div id="codapVersionDIV" class="stripe">
            <div class="stripe-element">
                <strong>CODAP version?</strong><br>
                <input type="radio" name="codap-version" value="v2" id="version-v2-radio" checked>
                <label for="version-v2-radio">Version 2</label>
                <input type="radio" name="codap-version" value="v3" id="version-v3-radio">
                <label for="version-v3-radio">Version 3</label>
            </div>
        </div>

        <div id="chooseDatasetDIV" class="stripe">
            <div class="stripe-element" id="chooseDatasetControl"></div>

        </div>

        <div id="summaryDIV" class="stripe">
            <div id="summaryInfo" class="stripe-element"></div>
        </div>

    </div>

    <div id="plot-matrix">
        <div class="stripe">
            <div style="text-align: center; font-weight: bold; margin-bottom: 20px;">
                Dataset: <span id="plot-matrix-dataset-name">No dataset selected</span>
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <label style="display: inline-flex; align-items: center; cursor: pointer;">
                <input 
                    type="checkbox" 
                    id="use-segmented-bars-checkbox" 
                    checked 
                    style="margin-right: 8px;">
                <span style="font-size: 14px;">Use segmented bar charts as needed</span>
            </label>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center;">
            <div style="margin-bottom: 8px;">
                <span style="font-size: 14px;">Include as legend attribute:</span>
            </div>
            <div>
                <select id="legend-attribute-dropdown" style="font-size: 14px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">[no legend attribute selected]</option>
                </select>
            </div>
        </div>

        <div class="stripe" style="margin-bottom: 20px;">
            <div id="plot-matrix-attribute-controls" style="display: flex; justify-content: center;">
                <table id="plot-matrix-attribute-table" style="border-collapse: collapse; width: 100%; max-width: 600px;">
                    <thead>
                        <tr>
                            <th style="text-align: center; padding: 8px; border-bottom: 1px solid #ccc; width: 80px;">Include</th>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc; width: 120px;">Type</th>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Attribute Name</th>
                        </tr>
                    </thead>
                    <tbody id="plot-matrix-attribute-tbody">
                        <!-- Attribute rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <div id="plot-matrix-attribute-count-notice" style="font-size: 14px; color: #333;">
                Attributes selected: 0 predictor, 0 response
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="create-plot-matrix-button" 
                onclick="multiVariateExtras.handlers.createPlotMatrix()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #2196F3; color: white; border: none; border-radius: 4px;">
                create plot matrix
            </button>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="add-least-squares-button" 
                onclick="multiVariateExtras.handlers.addLeastSquaresLines()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px;">
                add Least Squares lines to scatterplots (v3 only)
                <!-- in a Zoom meeting 2025-09-23, Bill Finzer said essentially: -->
                 <!-- v3 can do some things that v2 will never be able to do, like letting an API add annotations (trendline, etc) after creating a graph.
-->
            </button>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="delete-plot-matrix-button" 
                onclick="multiVariateExtras.handlers.deletePlotMatrix()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #f44336; color: white; border: none; border-radius: 4px;">
                Delete plot matrix for this dataset
            </button>
        </div>

        <!-- I'm allowing ridiculously large max values in case CODAP changes its units system ever.-->
        <div style="text-align: left; margin-bottom: 1px; padding-left: 1px;">
            <strong>For each plot:</strong>
        </div>
        <div class="stripe" style="margin-bottom: 1px; padding-left: 1px;">
            <div style="text-align: left; margin-bottom: 1px;">
                <label for="plot-width-input" style="margin-right: 1px;">Width:</label>
                <input type="number" id="plot-width-input" value="300" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px; margin-right: 1px;">
                <label for="plot-height-input" style="margin-right: 1px;">Height:</label>
                <input type="number" id="plot-height-input" value="250" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>

        <div style="text-align: left; margin-bottom: 1px; padding-left: 1px;">
            <strong>Upper-left corner of first plot:</strong>
        </div>
        <div class="stripe" style="margin-bottom: 1px; padding-left: 1px;">
            <div style="text-align: left; margin-bottom: 1px;">
                <label for="plot-x-input" style="margin-right: 1px;">x:</label>
                <input type="number" id="plot-x-input" value="200" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px; margin-right: 1px;">
                <label for="plot-y-input" style="margin-right: 1px;">y:</label>
                <input type="number" id="plot-y-input" value="100" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>

        <div style="text-align: left; margin-bottom: 1px; padding-left: 1px;">
            <strong>Spacing between plots:</strong>
        </div>
        <!-- I'm allowing negative values for two reasons: -->
        <!-- 1. If you specify a slightly negative value, you can make the plots overlap a bit to save space.-->
        <!-- You might need to be careful about which plot is on top then.-->
        <!-- 2. If you specify a negative value roughly the same size as the plot size (in x or y), and specify a large starting x or y value, you can make the plots be created from bottom-to-top or right-to-left or both. -->
        <div class="stripe" style="margin-bottom: 1px; padding-left: 1px;">
            <div style="text-align: left; margin-bottom: 1px;">
                <label for="plot-x-spacing-input" style="margin-right: 1px;">x spacing:</label>
                <input type="number" id="plot-x-spacing-input" value="5" min="-100000" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px; margin-right: 1px;">
                <label for="plot-y-spacing-input" style="margin-right: 1px;">y spacing:</label>
                <input type="number" id="plot-y-spacing-input" value="5" min="-100000" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>

        <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 20px;">
            Create a matrix of scatter plots showing relationships between all numeric attributes in the dataset.
        </div>

        <div style="text-align: left; font-size: 11px; color: #666; margin-bottom: 20px; padding-left: 20px; padding-right: 20px;">
            Units for height, width, and x,y are CODAP workspace pixels; the origin (0,0) is in the upper-left corner and y counts down rather than up.
        </div>

        <div id="plot-matrix-content" style="min-height: 200px;">
            <!-- Space for plot matrix features -->
        </div>

    </div>

    <div id="blocks-of-plots">
        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 14px; color: #333; padding: 10px;">
                Designate a block number for each attribute, then plot one block against itself or another block. Suggestion: use block 0 for attributes that you intend to never plot.
            </div>
        </div>

        <div class="stripe">
            <div style="text-align: center; font-weight: bold; margin-bottom: 20px;">
                Dataset: <span id="blocks-of-plots-dataset-name">No dataset selected</span>
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <label style="display: inline-flex; align-items: center; cursor: pointer;">
                <input 
                    type="checkbox" 
                    id="block-use-segmented-bars-checkbox" 
                    checked 
                    style="margin-right: 8px;">
                <span style="font-size: 14px;">Use segmented bar charts as needed</span>
            </label>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center;">
            <div style="margin-bottom: 8px;">
                <span style="font-size: 14px;">Include as legend attribute:</span>
            </div>
            <div>
                <select id="block-legend-attribute-dropdown" style="font-size: 14px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">[no legend attribute selected]</option>
                </select>
            </div>
        </div>

        <div class="stripe" style="margin-bottom: 20px;">
            <div id="blocks-of-plots-attribute-controls" style="display: flex; justify-content: center;">
                <table id="blocks-of-plots-attribute-table" style="border-collapse: collapse; width: 100%; max-width: 600px;">
                    <thead>
                        <tr>
                            <th style="text-align: center; padding: 8px; border-bottom: 1px solid #ccc; width: 80px;">Block#</th>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc; width: 120px;">Type</th>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Attribute Name</th>
                        </tr>
                    </thead>
                    <tbody id="blocks-of-plots-attribute-tbody">
                        <!-- Attribute rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <span style="font-size: 14px;">Predictor: Block#</span>
                <input type="number" id="block-predictor-input" value="1" min="0" max="100000" step="1" style="width: 30px; padding: 2px; border: 1px solid #ccc; border-radius: 1px;" oninput="multiVariateExtras_ui.updateBlocksOfPlotsAttributeCounts()">
                <button 
                    id="swap-blocks-button" 
                    onclick="multiVariateExtras_ui.swapBlockNumbers()"
                    style="background-color: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.4); border-radius: 4px; cursor: pointer; font-size: 18px; padding: 4px 6px; line-height: 1; display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s;"
                    onmouseover="this.style.backgroundColor='rgba(128, 128, 128, 0.35)'; this.style.borderColor='rgba(128, 128, 128, 0.6)'"
                    onmouseout="this.style.backgroundColor='rgba(128, 128, 128, 0.2)'; this.style.borderColor='rgba(128, 128, 128, 0.4)'"
                    title="Swap predictor and response block numbers">
                    â‡†
                </button>
                <span style="font-size: 14px;">Response: Block#</span>
                <input type="number" id="block-response-input" value="1" min="0" max="100000" step="1" style="width: 30px; padding: 2px; border: 1px solid #ccc; border-radius: 1px;" oninput="multiVariateExtras_ui.updateBlocksOfPlotsAttributeCounts()">
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <div id="blocks-of-plots-validation-error-notice" style="font-size: 14px; color: #d32f2f; display: none;">
                <!-- Validation errors will be displayed here -->
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <div id="blocks-of-plots-attribute-count-notice" style="font-size: 14px; color: #333;">
                Attributes selected: 0 predictor, 0 response
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="create-blocks-of-plots-button" 
                onclick="multiVariateExtras.handlers.createBlockPlotMatrix()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #2196F3; color: white; border: none; border-radius: 4px;">
                create block of plots
            </button>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="add-block-least-squares-button" 
                onclick="multiVariateExtras.handlers.addBlockLeastSquaresLines()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px;">
                add Least Squares lines to scatterplots (v3 only)
                <!-- in a Zoom meeting 2025-09-23, Bill Finzer said essentially: -->
                 <!-- v3 can do some things that v2 will never be able to do, like letting an API add annotations (trendline, etc) after creating a graph.
-->
            </button>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="delete-blocks-of-plots-button" 
                onclick="multiVariateExtras.handlers.deleteBlockPlotMatrix()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #f44336; color: white; border: none; border-radius: 4px;">
                Delete block of plots for this dataset
            </button>
        </div>

        <!-- I'm allowing ridiculously large max values in case CODAP changes its units system ever.-->
        <div style="text-align: left; margin-bottom: 1px; padding-left: 1px;">
            <strong>For each plot:</strong>
        </div>
        <div class="stripe" style="margin-bottom: 1px; padding-left: 1px;">
            <div style="text-align: left; margin-bottom: 1px;">
                <label for="block-plot-width-input" style="margin-right: 1px;">Width:</label>
                <input type="number" id="block-plot-width-input" value="300" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px; margin-right: 1px;">
                <label for="block-plot-height-input" style="margin-right: 1px;">Height:</label>
                <input type="number" id="block-plot-height-input" value="250" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>

        <div style="text-align: left; margin-bottom: 1px; padding-left: 1px;">
            <strong>Upper-left corner of first plot:</strong>
        </div>
        <div class="stripe" style="margin-bottom: 1px; padding-left: 1px;">
            <div style="text-align: left; margin-bottom: 1px;">
                <label for="block-plot-x-input" style="margin-right: 1px;">x:</label>
                <input type="number" id="block-plot-x-input" value="200" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px; margin-right: 1px;">
                <label for="block-plot-y-input" style="margin-right: 1px;">y:</label>
                <input type="number" id="block-plot-y-input" value="100" min="0" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>

        <div style="text-align: left; margin-bottom: 1px; padding-left: 1px;">
            <strong>Spacing between plots:</strong>
        </div>
        <!-- I'm allowing negative values for two reasons: -->
        <!-- 1. If you specify a slightly negative value, you can make the plots overlap a bit to save space.-->
        <!-- You might need to be careful about which plot is on top then.-->
        <!-- 2. If you specify a negative value roughly the same size as the plot size (in x or y), and specify a large starting x or y value, you can make the plots be created from bottom-to-top or right-to-left or both. -->
        <div class="stripe" style="margin-bottom: 1px; padding-left: 1px;">
            <div style="text-align: left; margin-bottom: 1px;">
                <label for="block-plot-x-spacing-input" style="margin-right: 1px;">x spacing:</label>
                <input type="number" id="block-plot-x-spacing-input" value="5" min="-100000" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px; margin-right: 1px;">
                <label for="block-plot-y-spacing-input" style="margin-right: 1px;">y spacing:</label>
                <input type="number" id="block-plot-y-spacing-input" value="5" min="-100000" max="100000" style="width: 50px; padding: 1px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>

        <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 20px;">
            Create a matrix of scatter plots showing relationships between attributes in the selected blocks.
        </div>

        <div style="text-align: left; font-size: 11px; color: #666; margin-bottom: 20px; padding-left: 20px; padding-right: 20px;">
            Units for height, width, and x,y are CODAP workspace pixels; the origin (0,0) is in the upper-left corner and y counts down rather than up.
        </div>

        <div id="blocks-of-plots-content" style="min-height: 200px;">
            <!-- Space for blocks of plots features -->
        </div>

    </div>

    <div id="correlation">
        <div class="stripe">
            <div style="text-align: center; font-weight: bold; margin-bottom: 20px;">
                Dataset: <span id="correlation-dataset-name">No dataset selected</span>
            </div>
        </div>

        <div class="stripe">
            <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 20px;">
                Ensure that each attribute has the correct type before computing the correlations. Attributes with no type listed will be treated as categorical.
            </div>
        </div>

        <div class="stripe" style="margin-bottom: 20px;">
            <div id="correlation-attribute-controls" style="display: flex; justify-content: center;">
                <table id="correlation-attribute-table" style="border-collapse: collapse; width: 100%; max-width: 600px;">
                    <thead>
                        <tr>
                            <th style="text-align: center; padding: 8px; border-bottom: 1px solid #ccc; width: 80px;">Include</th>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc; width: 120px;">Type</th>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ccc;">Attribute Name</th>
                        </tr>
                    </thead>
                    <tbody id="correlation-attribute-tbody">
                        <!-- Attribute rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="stripe" style="text-align: center; margin-bottom: 30px;">
            <button 
                id="compute-table-button" 
                onclick="multiVariateExtras.handlers.computeCorrelationTable()"
                style="margin-right: 20px; padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px;">
                compute table
            </button>
            <button 
                id="create-graph-button" 
                onclick="multiVariateExtras.handlers.graphCorrelationTable()"
                style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #2196F3; color: white; border: none; border-radius: 4px;">
                create graph
            </button>
        </div>
        
        <div class="stripe" style="text-align: center; margin-bottom: 20px;">
            <button 
                id="debug-tile-row-button" 
                onclick="multiVariateExtras.debugTileRowType()"
                style="margin-right: 20px; padding: 8px 16px; font-size: 12px; cursor: pointer; background-color: #9C27B0; color: white; border: none; border-radius: 4px;">
                debug tile row (v3)
            </button>
            <button 
                id="ensure-free-tile-row-button" 
                onclick="multiVariateExtras.ensureFreeTileRow()"
                style="margin-right: 20px; padding: 8px 16px; font-size: 12px; cursor: pointer; background-color: #E91E63; color: white; border: none; border-radius: 4px;">
                ensure free tile row (v3)
            </button>
        </div>

        <div style="text-align: left; font-size: 12px; color: #333; margin-bottom: 15px; padding-left: 20px;">
            <div style="margin-bottom: 8px;">
                <strong>What to do for Numeric Predictor, Categorical Response (NPCR):</strong>
            </div>
            <div style="margin-left: 20px; margin-bottom: 4px;">
                <input type="radio" name="npcr-option" value="leave-blank" id="npcr-leave-blank-radio" checked>
                <label for="npcr-leave-blank-radio" style="margin-left: 4px;">Leave blank</label>
            </div>
            <div style="margin-left: 20px; margin-bottom: 4px;">
                <input type="radio" name="npcr-option" value="use-eta" id="npcr-use-eta-radio">
                <label for="npcr-use-eta-radio" style="margin-left: 4px;">Use eta as if CPNR</label>
            </div>
        </div>

        <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 20px;">
            Correlation values will be APPENDED to the existing table, rather than replacing it. You should delete the old table before doing more computations, usually.
            In the graph, attributes will show in alphabetic order rather than their order in the table, unless you use the table_order_Predictor and table_order_Response attributes.
        </div>

        <div id="correlation-content" style="min-height: 200px;">
            <!-- Space for future correlation features -->
        </div>

    </div>



    <!--
        Cases and Tags
    -->


</div>


</body>
</html>
